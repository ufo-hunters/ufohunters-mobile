
var serviceURL = "http://www.ufo-hunters.com/";

$('#sightingsPage').bind('pageinit', function(event) {	
		getSightingsList();
});

function getSightingsList() {


	$.ajax({
	  dataType: "json",
	  url: serviceURL + 'reports.json',
	  beforeSend : function() {$.mobile.loading('show')},
      complete   : function() {$.mobile.loading('hide')},
	  type: "GET",
	  success: function(data){
			showInfo(data);
	  },
		error: function(dato){
			alert("You don't have internet connection, try more later");
	  }
	});


    //$.getJSON(serviceURL + 'reports.json', function(data) {
    function showInfo(data) {	
	     $('#sightingsList li').remove();
	     $.each(data, function(key, val) {
		     var sightingDate = val.sighted_at;
			 var sightingDay;
			 var sightingMonth; 
			 var sightingYear; 
		     if (sightingDate.length >= 8) {
		    	 var year = sightingDate.substring(0,4);
		    	 var month = sightingDate.substring(4,6);
		    	 var day = sightingDate.substring(6,8);
		    	 var date = new Date(year, month-1, day);					
		    	 sightingDate = $.datepicker.formatDate("DD d. MM yy", date);	
				 sightingDay = $.datepicker.formatDate("d", date);
				 sightingMonth = $.datepicker.formatDate("M", date).toUpperCase();	
				 sightingYear = $.datepicker.formatDate("yy", date);					 
		     } else {
		    	 sightingDate = "N/A";
		     }
		     $('#sightingsList').append('<li><a href="report.html?id=' + val._id + '"><strong><em>' + sightingDay + '</em><i class="' + sightingMonth + '">' + sightingMonth + '</i><b class="' + sightingMonth + '">' + sightingYear + '</b></strong><b>' + val.location + '</b><p><u>Reported on:</u>' + sightingDate + '</p><p><u>Shape:</u>' + sightingDay + '</p></li>');
			 
		  });		
		$('#sightingsList').listview('refresh');
	}		
	//});
}
